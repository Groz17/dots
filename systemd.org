* Mail
** Sync
*** Service
#+begin_src conf :tangle ~/.config/systemd/user/mail-sync.service
[Unit]
Description=Mail Sync Service
After=network-online.target

[Service]
Type=oneshot
ExecStart=%h/bin/%p.sh

[Install]
WantedBy=default.target
#+end_src

*** Script
Taken from: =https://man.sr.ht/~rjarry/aerc/integrations/notmuch.md=

#+begin_src sh :tangle ~/bin/mail-sync.sh :shebang "#!/bin/sh"
MBSYNC=$(pgrep mbsync)
NOTMUCH=$(pgrep notmuch)

if [ -n "$MBSYNC" -o -n "$NOTMUCH" ]; then
    echo "Already running one instance of mbsync or notmuch. Exiting..."
    exit 0
fi

echo "Deleting messages tagged as *deleted*"
notmuch search --format=text0 --output=files tag:deleted | xargs -0 --no-run-if-empty rm -v

mbsync -Va
notmuch new
#+end_src

*** Timer
#+begin_src conf :tangle ~/.config/systemd/user/mail-sync.timer
[Unit]
Description=Mail Sync Timer

[Timer]
OnBootSec=2m
OnUnitActiveSec=2m
Persistent=true

[Install]
WantedBy=timers.target
#+end_src

** Oauth2
#+begin_src conf :tangle ~/.config/systemd/user/pizauth.service
[Unit]
Description=Pizauth OAuth2 token manager

[Service]
Type=simple
ExecStart=/usr/local/bin/pizauth server -vvvv -d
ExecReload=/usr/local/bin/pizauth reload
ExecStop=/usr/local/bin/pizauth shutdown

[Install]
WantedBy=default.target
#+end_src
